<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="/assets/all.css">

  <style>


    .done {
      display: none;
    }
   
  </style>
</head>

<body>


  <nav>
    <div class="nav-wrapper">
      <a href="/" class="brand-logo">MyWishList</a>
      <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
      <ul class="right hide-on-med-and-down">
        <li id="signOutConditional"></li>
      </ul>
    </div>
  </nav>
  
  <ul class="sidenav" id="mobile-demo">
    <li id="signOutNav"></li>
  </ul>



  <div class="container">

    <div id="title" class="center"></div>

   
   



        <div class="collection" id="myItemsDiv"></div>



      


      </form>
    </div>

  </div>

  <script src="./assets/all.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <script>

    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('.sidenav');
        var instances = M.Sidenav.init(elems, {});
      })

      M.AutoInit();
      document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('select');
        var instances = M.FormSelect.init(elems, {});
      })

    let listId = window.location.pathname.substr(window.location.pathname.length - 10);
    // console.log(listId)

    let newListData
    let newID

    axios.get(`/api/list/${listId}`, {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    })
      .then(({ data }) => {

        newListData = data
        console.log(newListData.id)
        newID = newListData.id
        console.log(newListData, 'lists')
        document.getElementById('title').innerHTML = 
        `<h2> ${data.title} </h2>
        
        by <h4> ${data.User.username} </h4>
        `
      })
    axios.get(`/api/items`, {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    })
      .then(({ data }) => {
        console.log(data), 'items'

        data.forEach(item => {

          console.log(newID)
          if (item.lid == newID) {
            console.log('da same')
            document.getElementById('myItemsDiv').innerHTML += `
                
                <li data-description='${item.description}' class="collection-item ${item.isDone ? 'done' : ""}"> ${item.description}
                <a class="truncate" data-link="${item.link}" target="_blank" href="${item.link}">${item.link}</a> 
                <i data-id='${item.id}' class="material-icons checkBtn green-text">check</i>
                </li>
                
                `

          }
        }
        )
      })

      .catch(err => console.log(err))


    document.addEventListener('click', event => {

      if (event.target.classList.contains('checkBtn')) {
        let upDatedItem = {
          description: event.target.dataset.description, 
          link: event.target.dataset.link,
          isDone: true
        }
        axios.put(`/api/items/${event.target.dataset.id}`, upDatedItem, {
          
        })
          .then(res => {
            console.log('updated')
            window.location.reload()

          })

      }
    })

    function displaySignOut() {

        localStorage.getItem('token')
        if (localStorage.getItem("token") === null) {
          const signOut2 = document.createElement('li')
          signOut2.innerHTML = `
      <li id="logInButtonMain"><a href="/login">Log In</a></li>
      `
          document.getElementById('signOutConditional').append(signOut2)
          document.getElementById('logInButtonMain').addEventListener('click', event => {
            window.location = '/login'
          })


        } else {

          const signOut1 = document.createElement('li')
          signOut1.innerHTML = `
      <li id="signOutMain"><a href="/login">Sign Out</a></li>
      `
          document.getElementById('signOutConditional').append(signOut1)
          document.getElementById('signOutMain').addEventListener('click', event => {
            localStorage.removeItem('token')
            window.location = '/login'
          })

        }
      }

      function displaySignOutNav() {

        localStorage.getItem('token')
        if (localStorage.getItem("token") === null) {
          const signOut2 = document.createElement('li')
          signOut2.innerHTML = `
      <li id="logInButtonNav"><a href="/login">Log In</a></li>
      `
          document.getElementById('signOutNav').append(signOut2)
          document.getElementById('logInButtonNav').addEventListener('click', event => {
            window.location = '/login'
          })
        } else {

          const signOut1 = document.createElement('li')
          signOut1.innerHTML = `
      <li id="signOutButtonNav"><a href="/login">Sign Out</a></li>
      `
          document.getElementById('signOutNav').append(signOut1)
          document.getElementById('signOutButtonNav').addEventListener('click', event => {
            localStorage.removeItem('token')
            window.location = '/login'
          })
        }
      }


      displaySignOut()
      displaySignOutNav()





















  </script>

</body>

</html>