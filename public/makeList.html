<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

  <style>
    
  </style>
</head>
<body>



  <div class="container">

  <div id="title" class="center"></div>

<div class="row center">
  Both title and link are optional, however at least one is required. 
</div>



<div class="row">
  <form class="col s12">
    <div class="row">
      <div class="input-field col s12">
        <input placeholder="title" id="myDescription" type="text" class="validate">
        <label for="first_name">Title/description (if any)</label>
      </div>
      <div class="input-field col s12">
        <input id="myLink" type="text">
        <label for="link">Link</label>
      </div>
    </div>

    <a id="addItem" class="waves-effect waves-light btn-small">Add Item</a>


    <div class="collection" id="myItemsDiv"></div>
   
   
    
  </form>
</div>

</div>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <script>

  let listId = window.location.pathname.substr(window.location.pathname.length - 10);
  // console.log(listId)

  let newData

  axios.get(`/api/list/${listId}`, {
  headers: {
  'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
  })
  .then(({ data }) => {
  newData = data
  document.getElementById('title').innerHTML = `<h2> ${data.title} </h2>`
  })
  .catch(err => console.log(err))


  document.getElementById('addItem').addEventListener('click', event => {
      event.preventDefault()
    if (document.getElementById('myDescription').value=='' && document.getElementById('myLink').value==''){
      alert('you must have either a description or a link')
      return
    }

      let item = {
        description: document.getElementById('myDescription').value,
        link: document.getElementById('myLink').value,
        isDone: false,
        lid: newData.id
      }
      //create comment call
      axios.post('/api/items', item, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      })
        .then(({ data }) => {
          // console.log(data)
          document.getElementById('myDescription').value = ''
          document.getElementById('myLink').value = ''
          document.getElementById('myItemsDiv').innerHTML += `
          <li class = "collection-item"> ${data.description} <a class="truncate" target="_blank" href="${data.link}">${data.link}</a> </li>
          `



        })
        .catch(err => console.log(err))
    })




 

  </script>

</body>
</html>